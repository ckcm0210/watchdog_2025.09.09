# 調試信息參考指南

本文檔提供 Excel Watchdog 程式中各種調試信息的詳細說明，幫助您理解監控輸出。

## 基礎日誌格式

調試信息通常採用以下格式：
```
[類別] 信息內容
```

例如：`[memory] 讀取前: 156.25 MB`

## 主要調試信息類別

### 1. 檔案資訊 (`[file-info]`)

提供關於正在處理的檔案的詳細信息：

- **大小**：檔案的大小，以 MB 為單位
  ```
  [file-info] 大小: 12.6 MB
  ```

- **修改時間**：檔案最後修改的時間
  ```
  [file-info] 修改時間: 2025-09-05 21:26:15
  ```

- **存取時間**：檔案最後被訪問的時間
  ```
  [file-info] 存取時間: 2025-09-05 21:26:15
  ```

- **存取間隔**：修改時間和存取時間之間的秒數
  ```
  [file-info] 存取間隔: 0.02 秒
  ```
  
  **說明**：存取間隔較小（< 0.5 秒）可能表示檔案剛被修改就立即被讀取，這種情況下檔案可能仍被其他程序鎖定，是潛在的風險點。

### 2. 記憶體監控 (`[memory]`)

追踪程式的記憶體使用情況：

- **讀取前**：操作開始前的記憶體使用量
  ```
  [memory] 讀取前: 156.25 MB
  ```

- **讀取後**：操作完成後的記憶體使用量
  ```
  [memory] 讀取後: 182.70 MB
  ```

  **說明**：較大的記憶體增長（>50MB）可能需要關注，特別是如果沒有處理大型檔案。

### 3. 垃圾回收信息 (`[gc]`)

提供關於 Python 垃圾回收器的詳細信息：

- **回收統計**：
  ```
  [gc] 回收前對象: (1245, 412, 10), 回收後: (1224, 398, 0), 釋放: 28
  ```

  **參數解釋**：
  - 回收前對象 `(1245, 412, 10)`：三個數字分別表示不同世代的對象數量
    - 第一個數字 (1245)：第0代對象數量（新創建的對象）
    - 第二個數字 (412)：第1代對象數量（存活了一次回收的對象）
    - 第三個數字 (10)：第2代對象數量（存活了多次回收的老對象）
  
  - 回收後 `(1224, 398, 0)`：垃圾回收後各世代剩餘對象數量
  
  - 釋放 `28`：總共釋放的對象數量

  **說明**：如果釋放的對象數量很小但記憶體使用仍然很高，可能表示存在無法回收的對象或記憶體洩漏。

- **詳細說明**：
  ```
  [gc-說明] 第0代 (新對象): 1245->1224
  [gc-說明] 第1代 (中年對象): 412->398
  [gc-說明] 第2代 (老對象): 10->0
  ```

### 4. 警告信息 (`[warning]`)

當檢測到潛在問題時發出的警告：

- **記憶體增長過大**：
  ```
  [warning] 記憶體增長過大: +126.45 MB
  ```
  
  **說明**：超過 100MB 的記憶體增長被視為潛在風險，特別是對於小型檔案。

- **檔案句柄過多**：
  ```
  [warning] 打開檔案數過多: 78
  ```
  
  **說明**：過多打開的檔案可能導致資源耗盡，通常應小於 50。

### 5. 快取相關信息 (`[info]`)

關於檔案快取操作的信息：

- **路徑已在快取中**：
  ```
  [info] 路徑已在快取中，直接使用: C:\Users\user\Desktop\watchdog\cache_folder\hash_file.xlsx
  ```

  **說明**：表示程式識別到此檔案已在快取中，避免了重複快取操作。

### 6. 操作日誌 (`[OPERATION]`)

記錄主要操作事件：

- **操作開始**：
  ```
  [OPERATION] 開始讀取 Excel 檔案 (路徑=C:\example.xlsx, 引擎=polars_xml)
  ```

- **操作完成**：
  ```
  [OPERATION] Excel 讀取完成 (路徑=C:\example.xlsx, 工作表數=3)
  ```

### 7. 資源追踪 (`[RESOURCES]`)

監控系統資源使用情況：

- **打開檔案數**：
  ```
  [RESOURCES] 當前打開檔案數: 23
  ```

## 如何啟用全部調試信息

要確保所有調試信息都能顯示，請：

1. 確保已安裝 `psutil` 庫：
   ```
   pip install psutil
   ```

2. 在設定中啟用調試信息：
   - 設置 `SHOW_DEBUG_MESSAGES = True`
   - 設置 `ENABLE_MEMORY_MONITOR = True`

3. 執行測試腳本檢查設置是否正確：
   ```
   python test_debug_messages.py
   ```

## 故障排除

如果仍然看不到調試信息：

1. **檢查控制台緩衝**：某些控制台應用可能會限制顯示的輸出量。

2. **檢查輸出重定向**：確保輸出沒有被重定向到檔案。

3. **檢查設置載入**：確保設定檔正確載入並被應用。

4. **增加日誌文件輸出**：如果需要，可以修改 `enhanced_logging_and_error_handler.py` 將輸出同時寫入檔案。